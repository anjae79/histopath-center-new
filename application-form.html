<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¡°ì§ë³‘ë¦¬í•µì‹¬ì„¼í„° ë¶„ì„ ì‹ ì²­ì„œ</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            line-height: 1.2;
            margin: 0;
            padding: 8px;
            background-color: #f5f5f5;
            font-size: 11px;
        }
        
        .application-form {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-header {
            text-align: center;
            margin-bottom: 12px;
            border-bottom: 2px solid #005baa;
            padding-bottom: 8px;
            position: relative;
        }
        
        .form-header h1 {
            color: #005baa;
            margin: 2px 0;
            font-size: 18px;
            font-weight: bold;
        }
        
        .form-header .subtitle {
            color: #666;
            margin-top: 4px;
            font-size: 12px;
        }
        
        .form-section {
            margin-bottom: 8px;
        }
        
        .section-title {
            background: linear-gradient(90deg, #005baa 0%, #00A54D 100%);
            color: white;
            padding: 4px 8px;
            margin: 0 0 6px 0;
            font-weight: bold;
            font-size: 11px;
        }
        
        .form-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 6px;
        }
        
        .form-table th,
        .form-table td {
            border: 1px solid #ddd;
            padding: 3px 6px;
            text-align: left;
            vertical-align: top;
            font-size: 10px;
        }
        
        .form-table th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f4fd 100%);
            font-weight: bold;
            width: 100px;
            color: #005baa;
        }
        
        .form-table input[type="text"],
        .form-table input[type="email"],
        .form-table input[type="tel"],
        .form-table input[type="date"],
        .form-table input[type="number"],
        .form-table textarea,
        .form-table select {
            width: 100%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
            box-sizing: border-box;
        }
        
        .form-table textarea {
            resize: vertical;
            min-height: 30px;
        }
        
        .services-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 4px;
        }
        
        .services-table th,
        .services-table td {
            border: 1px solid #ddd;
            padding: 4px;
            text-align: center;
            font-size: 11px;
        }
        
        .services-table th {
            background: linear-gradient(135deg, #005baa 0%, #00A54D 100%);
            color: white;
            font-weight: bold;
        }
        
        .services-table input[type="number"],
        .services-table input[type="text"],
        .services-table select {
            width: 100%;
            padding: 3px;
            border: 1px solid #ddd;
            border-radius: 2px;
            font-size: 11px;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
        }
        
        .checkbox-item input[type="checkbox"] {
            margin: 0;
            transform: scale(1.0);
            accent-color: #00A54D;
        }
        
        .signature-section {
            margin-top: 8px;
            text-align: right;
            font-size: 10px;
        }
        
        .signature-box {
            display: inline-block;
            border: 2px solid #005baa;
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f4fd 100%);
            width: 80px;
            height: 30px;
            margin-left: 8px;
            vertical-align: top;
        }
        
        .form-footer {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #666;
            font-size: 10px;
        }
        
        .required {
            color: #00A54D;
            font-weight: bold;
        }
        
        .receipt-number-section {
            margin-bottom: 4px;
            display: flex;
            justify-content: flex-end;
        }
        
        .receipt-number-box {
            border: 1px solid #005baa;
            padding: 3px;
            border-radius: 3px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f4fd 100%);
            width: 160px;
        }
        
        .receipt-number-box label {
            display: block;
            font-weight: bold;
            color: #005baa;
            margin-bottom: 4px;
            font-size: 11px;
        }

        /* ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ - ë°ìŠ¤í¬í†± ë ˆì´ì•„ì›ƒ ìœ ì§€ */
        @media print {
            @page {
                margin: 25mm 15mm 25mm 15mm;
                size: A4;
            }
            
            body {
                background-color: white !important;
                font-size: 9px !important;
                line-height: 1.1 !important;
                color: black !important;
                margin: 0 !important;
                padding: 0 !important;
                display: block !important;
            }
            
            .application-form {
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                transform: none !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            
            .form-header {
                margin-bottom: 8px !important;
                padding-bottom: 6px !important;
                margin-top: 0 !important;
                padding-top: 0 !important;
            }
            
            .form-header h1 {
                color: black !important;
                font-size: 18px !important;
                margin: 0 0 4px 0 !important;
                padding: 0 !important;
            }
            
            .form-header .subtitle {
                color: black !important;
                font-size: 12px !important;
                margin: 0 !important;
            }
            
            .section-title {
                background: linear-gradient(90deg, #005baa 0%, #00A54D 100%) !important;
                color: white !important;
                padding: 5px 8px !important;
                margin: 6px 0 6px 0 !important;
                font-size: 12px !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .form-section {
                margin-bottom: 6px !important;
            }
            
            .form-table,
            .services-table {
                margin-bottom: 5px !important;
            }
            
            .form-table th,
            .form-table td,
            .services-table th,
            .services-table td {
                padding: 3px 5px !important;
                font-size: 10px !important;
                line-height: 1.2 !important;
            }
            
            .form-table th,
            .services-table th {
                background: linear-gradient(135deg, #f8f9fa 0%, #e8f4fd 100%) !important;
                color: #005baa !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .form-table input,
            .form-table textarea,
            .form-table select,
            .services-table input,
            .services-table select {
                font-size: 9px !important;
                padding: 2px !important;
            }
            
            .form-table textarea {
                min-height: 12px !important;
            }
            
            .checkbox-group {
                gap: 2px !important;
            }
            
            .checkbox-item {
                font-size: 9px !important;
                gap: 2px !important;
            }
            
            .checkbox-item input[type="checkbox"] {
                transform: scale(0.8) !important;
            }
            
            h5 {
                font-size: 9px !important;
                margin: 3px 0 !important;
            }
            
            div[style*="grid-template-columns"] {
                gap: 4px !important;
                margin-bottom: 3px !important;
            }
            
            .receipt-number-box {
                background: linear-gradient(135deg, #f8f9fa 0%, #e8f4fd 100%) !important;
                border-color: #005baa !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .receipt-number-box label {
                color: #005baa !important;
            }
            
            .signature-box {
                background: linear-gradient(135deg, #f8f9fa 0%, #e8f4fd 100%) !important;
                border-color: #005baa !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            .required {
                color: #00A54D !important;
            }
            
            h5 {
                color: #005baa !important;
            }
            
            .checkbox-item input[type="checkbox"] {
                accent-color: #00A54D !important;
            }
            
            /* ìƒ‰ìƒ ìœ ì§€ ê°•ì œ */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }

        
        .receipt-number-box input {
            width: 100%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
            box-sizing: border-box;
            text-align: center;
            font-weight: bold;
        }
        
        .print-btn {
            background: linear-gradient(90deg, #005baa 0%, #00A54D 100%);
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin: 10px 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .print-btn:hover {
            background: linear-gradient(90deg, #004494 0%, #008a42 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        @media screen and (max-width: 768px) {
            body {
                font-size: 12px;
                padding: 4px;
            }
            
            .application-form {
                max-width: 100%;
                margin: 0;
                padding: 10px;
                border-radius: 4px;
            }
            
            .form-header h1 {
                font-size: 16px;
                margin: 4px 0;
            }
            
            .form-header .subtitle {
                font-size: 11px;
            }
            
            .section-title {
                font-size: 12px;
                padding: 6px 8px;
                margin-bottom: 8px;
            }
            
            .form-table {
                display: block;
                overflow-x: auto;
                border: none;
            }
            
            .form-table tr {
                display: block;
                margin-bottom: 10px;
                border: 1px solid #ddd;
                border-radius: 6px;
                padding: 8px;
                background: #f9f9f9;
            }
            
            .form-table th,
            .form-table td {
                display: block;
                width: 100% !important;
                border: none;
                padding: 4px 0;
                text-align: left;
            }
            
            .form-table th {
                background: none;
                color: #2c5282;
                font-weight: bold;
                margin-bottom: 4px;
                font-size: 12px;
            }
            
            .form-table input,
            .form-table select,
            .form-table textarea {
                width: 100%;
                font-size: 14px;
                padding: 8px;
                border-radius: 4px;
            }
            
            .services-table {
                display: block;
                overflow-x: auto;
                border: none;
            }
            
            .services-table thead {
                display: none;
            }
            
            .services-table tr {
                display: block;
                margin-bottom: 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 10px;
                background: #f9f9f9;
            }
            
            .services-table td {
                display: block;
                width: 100%;
                border: none;
                padding: 4px 0;
                position: relative;
                text-align: left;
            }
            
            .services-table td:before {
                content: attr(data-label) ": ";
                font-weight: bold;
                color: #2c5282;
                display: block;
                margin-bottom: 2px;
                font-size: 11px;
            }
            
            .services-table input,
            .services-table select {
                width: 100%;
                font-size: 14px;
                padding: 6px;
                border-radius: 4px;
            }
            
            .checkbox-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .checkbox-item {
                font-size: 12px;
                align-items: flex-start;
            }
            
            .checkbox-item input[type="checkbox"] {
                transform: scale(1.2);
                margin-right: 8px;
            }
            
            .receipt-number-section {
                justify-content: center;
                margin-bottom: 8px;
            }
            
            .receipt-number-box {
                width: 100%;
                max-width: 250px;
                padding: 8px;
            }
            
            .receipt-number-box label {
                font-size: 12px;
            }
            
            .receipt-number-box input {
                font-size: 14px;
                padding: 6px;
            }
            
            .signature-section {
                text-align: center;
                margin-top: 15px;
            }
            
            .signature-section p {
                margin-bottom: 8px;
                font-size: 12px;
            }
            
            .signature-box {
                width: 100px;
                height: 40px;
                margin: 0 auto;
                display: block;
            }
            
            .form-footer {
                text-align: center;
                font-size: 11px;
                line-height: 1.4;
            }
            
            .form-footer p {
                margin-bottom: 6px;
            }
            
            .print-btn {
                width: 100%;
                padding: 12px;
                font-size: 14px;
                margin-top: 15px;
                border-radius: 6px;
            }
            
            /* ë¶„ì„ ì„ íƒ ê·¸ë¦¬ë“œë¥¼ ëª¨ë°”ì¼ì—ì„œ ë‹¨ì¼ ì»¬ëŸ¼ìœ¼ë¡œ */
            div[style*="grid-template-columns"] {
                display: block !important;
            }
            
            div[style*="grid-template-columns"] > div {
                margin-bottom: 15px;
            }
            
            h5 {
                font-size: 13px !important;
                margin: 8px 0 !important;
            }
        }
        

    </style>
</head>
<body>
    <div class="application-form">
        <div class="form-header">
            <h1>ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„°</h1>
            <h1>ì‹ ì²­ì„œ</h1>
            <div class="subtitle">Histopathology Core Center Request Form</div>
        </div>

        <form id="applicationForm">
            <!-- ì ‘ìˆ˜ë²ˆí˜¸ -->
            <div class="receipt-number-section">
                <div class="receipt-number-box">
                    <label for="receipt_number_top">ì ‘ìˆ˜ë²ˆí˜¸ (Receipt No.)</label>
                    <input type="text" id="receipt_number_top" name="receipt_number_top" placeholder="ìë™ ìƒì„±ë©ë‹ˆë‹¤" readonly style="background-color: #f8f9fa;">
                </div>
            </div>
            
            <!-- ì‹ ì²­ì ì •ë³´ -->
            <div class="form-section">
                <div class="section-title">â–  ì‹ ì²­ì ì •ë³´ (Applicant Information)</div>
                <table class="form-table">
                    <tr>
                        <th style="width: 80px;">ì‹ ì²­ì¼ <span class="required">*</span></th>
                        <td style="width: 120px;"><input type="date" name="application_date" required></td>
                        <th style="width: 100px;">ì‹ ì²­ì/ë‹´ë‹¹êµìˆ˜ <span class="required">*</span></th>
                        <td colspan="3"><input type="text" name="applicant_name" placeholder="ì‹ ì²­ì/ë‹´ë‹¹êµìˆ˜" autocomplete="name" required></td>
                    </tr>
                    <tr>
                        <th style="width: 80px;">ì†Œì†ê¸°ê´€ <span class="required">*</span></th>
                        <td style="width: 200px;"><input type="text" name="institution" placeholder="ì†Œì†ê¸°ê´€" autocomplete="organization" required></td>
                        <th style="width: 80px;">ë¶€ì„œ/í•™ê³¼</th>
                        <td colspan="3"><input type="text" name="department" placeholder="ë¶€ì„œ/í•™ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="organization-title"></td>
                    </tr>
                    <tr>
                        <th style="width: 80px;">ì—°ë½ì²˜ <span class="required">*</span></th>
                        <td style="width: 200px;"><input type="tel" name="phone" placeholder="ì—°ë½ ê°€ëŠ¥í•œ ì „í™”ë²ˆí˜¸" autocomplete="tel" required></td>
                        <th style="width: 80px;">ì´ë©”ì¼ <span class="required">*</span></th>
                        <td colspan="3"><input type="email" name="email" placeholder="ê²°ê³¼ ìˆ˜ë ¹ìš© ì´ë©”ì¼ ì£¼ì†Œ" autocomplete="email" required></td>
                    </tr>
                </table>
            </div>

            <!-- ë¶„ì„ ì‹ ì²­ ë‚´ì—­ -->
            <div class="form-section">
                <div class="section-title">â–  ì‹ ì²­ ë‚´ì—­ (Request Details)</div>
                
                <!-- ë¶„ì„ ì„ íƒ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px;">
                    <div>
                        <h5 style="margin: 5px 0; font-size: 12px; font-weight: bold; color: #005baa;">1. ê¸°ë³¸ ì¡°ì§ì²˜ë¦¬</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="paraffin" name="services" value="paraffin">
                                <label for="paraffin">íŒŒë¼í•€ í¬ë§¤</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="frozen" name="services" value="frozen">
                                <label for="frozen">ë™ê²°ì ˆí¸</label>
                            </div>
                        </div>
                        
                        <h5 style="margin: 5px 0; font-size: 12px; font-weight: bold; color: #005baa;">2. íŠ¹ìˆ˜ì—¼ìƒ‰</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="pas" name="services" value="pas">
                                <label for="pas">PAS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="masson" name="services" value="masson">
                                <label for="masson">Masson</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="alcian_blue" name="services" value="alcian_blue">
                                <label for="alcian_blue">Alcian Blue</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="pico_sirius_red" name="services" value="pico_sirius_red">
                                <label for="pico_sirius_red">Pico Sirius Red</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="other_special" name="services" value="other_special">
                                <label for="other_special">ê¸°íƒ€ íŠ¹ìˆ˜ì—¼ìƒ‰</label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h5 style="margin: 5px 0; font-size: 12px; font-weight: bold; color: #005baa;">3. ë©´ì—­ì—¼ìƒ‰</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="ihc" name="services" value="ihc">
                                <label for="ihc">IHC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="icc" name="services" value="icc">
                                <label for="icc">ICC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="if_staining" name="services" value="if_staining">
                                <label for="if_staining">IF</label>
                            </div>
                        </div>
                        
                        <h5 style="margin: 5px 0; font-size: 12px; font-weight: bold; color: #005baa;">4. ë¶„ìë³‘ë¦¬ & ê¸°íƒ€</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="fish" name="services" value="fish">
                                <label for="fish">FISH</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dna_extraction" name="services" value="dna_extraction">
                                <label for="dna_extraction">DNA ì¶”ì¶œ</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="rna_extraction" name="services" value="rna_extraction">
                                <label for="rna_extraction">RNA ì¶”ì¶œ</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="tma" name="services" value="tma">
                                <label for="tma">TMA</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì„œë¹„ìŠ¤ ìƒì„¸ ì •ë³´ í…Œì´ë¸” -->
                <table class="services-table">
                    <thead>
                        <tr>
                            <th>ê²€ì²´ ìˆ˜<br>(Sample Count)</th>
                            <th>ì˜ë¢° ë¶„ì„<br>(Analysis)</th>
                            <th>ì„¸ë¶€ ë¶„ì„<br>(Detail Analysis)</th>
                            <th>ìŠ¬ë¼ì´ë“œ ìˆ˜<br>(Slide Count)</th>
                            <th>ì˜ë¢° ì´ìˆ˜ëŸ‰<br>(Total Count)</th>
                            <th>ë¹„ê³ <br>(Note)</th>
                        </tr>
                    </thead>
                    <tbody id="servicesTableBody">
                        <tr>
                            <td data-label="ê²€ì²´ ìˆ˜"><input type="number" name="sample_count_1" min="1" placeholder=""></td>
                            <td data-label="ì˜ë¢° ë¶„ì„"><input type="text" name="service_name_1" placeholder="ë¶„ì„ëª…"></td>
                            <td data-label="ì„¸ë¶€ ë¶„ì„"><input type="text" name="antibody_type_1" placeholder="ì„¸ë¶€ë¶„ì„"></td>
                            <td data-label="ìŠ¬ë¼ì´ë“œ ìˆ˜"><input type="number" name="slide_count_1" min="1" placeholder=""></td>
                            <td data-label="ì˜ë¢° ì´ìˆ˜ëŸ‰"><input type="number" name="total_count_1" readonly></td>
                            <td data-label="ë¹„ê³ "><input type="text" name="note_1" placeholder="ë¹„ê³ "></td>
                        </tr>
                        <tr>
                            <td data-label="ê²€ì²´ ìˆ˜"><input type="number" name="sample_count_2" min="1" placeholder=""></td>
                            <td data-label="ì˜ë¢° ë¶„ì„"><input type="text" name="service_name_2" placeholder="ë¶„ì„ëª…"></td>
                            <td data-label="ì„¸ë¶€ ë¶„ì„"><input type="text" name="antibody_type_2" placeholder="ì„¸ë¶€ë¶„ì„"></td>
                            <td data-label="ìŠ¬ë¼ì´ë“œ ìˆ˜"><input type="number" name="slide_count_2" min="1" placeholder=""></td>
                            <td data-label="ì˜ë¢° ì´ìˆ˜ëŸ‰"><input type="number" name="total_count_2" readonly></td>
                            <td data-label="ë¹„ê³ "><input type="text" name="note_2" placeholder="ë¹„ê³ "></td>
                        </tr>
                        <tr>
                            <td data-label="ê²€ì²´ ìˆ˜"><input type="number" name="sample_count_3" min="1" placeholder=""></td>
                            <td data-label="ì˜ë¢° ë¶„ì„"><input type="text" name="service_name_3" placeholder="ë¶„ì„ëª…"></td>
                            <td data-label="ì„¸ë¶€ ë¶„ì„"><input type="text" name="antibody_type_3" placeholder="ì„¸ë¶€ë¶„ì„"></td>
                            <td data-label="ìŠ¬ë¼ì´ë“œ ìˆ˜"><input type="number" name="slide_count_3" min="1" placeholder=""></td>
                            <td data-label="ì˜ë¢° ì´ìˆ˜ëŸ‰"><input type="number" name="total_count_3" readonly></td>
                            <td data-label="ë¹„ê³ "><input type="text" name="note_3" placeholder="ë¹„ê³ "></td>
                        </tr>
                        <tr>
                            <td data-label="ê²€ì²´ ìˆ˜"><input type="number" name="sample_count_4" min="1" placeholder=""></td>
                            <td data-label="ì˜ë¢° ë¶„ì„"><input type="text" name="service_name_4" placeholder="ë¶„ì„ëª…"></td>
                            <td data-label="ì„¸ë¶€ ë¶„ì„"><input type="text" name="antibody_type_4" placeholder="ì„¸ë¶€ë¶„ì„"></td>
                            <td data-label="ìŠ¬ë¼ì´ë“œ ìˆ˜"><input type="number" name="slide_count_4" min="1" placeholder=""></td>
                            <td data-label="ì˜ë¢° ì´ìˆ˜ëŸ‰"><input type="number" name="total_count_4" readonly></td>
                            <td data-label="ë¹„ê³ "><input type="text" name="note_4" placeholder="ë¹„ê³ "></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ê²€ì²´ ì •ë³´ -->
            <div class="form-section">
                <div class="section-title">â–  ê²€ì²´ ì •ë³´ (Sample Information)</div>
                <table class="form-table">
                    <tr>
                        <th>ê²€ì²´ëª… (Sample Name) <span class="required">*</span></th>
                        <td><textarea name="sample_name" placeholder="ê²€ì²´ëª…ì„ ìƒì„¸íˆ ê¸°ì¬í•´ì£¼ì„¸ìš”" autocomplete="off" required></textarea></td>
                    </tr>
                    <tr>
                        <th>ê²€ì²´ ì¢…ë¥˜ (Sample Type)</th>
                        <td>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="tissue" name="sample_type" value="tissue">
                                    <label for="tissue">ì¡°ì§ (Tissue)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="cell" name="sample_type" value="cell">
                                    <label for="cell">ì„¸í¬ (Cell)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="other_sample" name="sample_type" value="other">
                                    <label for="other_sample">ê¸°íƒ€</label>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>ê³ ì •ì•¡ (Fixative)</th>
                        <td>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="nbf" name="fixative" value="nbf">
                                    <label for="nbf">10% NBF</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="alcohol" name="fixative" value="alcohol">
                                    <label for="alcohol">Alcohol</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="other_fixative" name="fixative" value="other">
                                    <label for="other_fixative">ê¸°íƒ€</label>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>íŠ¹ë³„ ìš”ì²­ì‚¬í•­ (Special Requests)</th>
                        <td><textarea name="special_requests" placeholder="íŠ¹ë³„í•œ ì²˜ë¦¬ ë°©ë²•ì´ë‚˜ ì£¼ì˜ì‚¬í•­ì´ ìˆìœ¼ë©´ ê¸°ì¬í•´ì£¼ì„¸ìš”" autocomplete="off"></textarea></td>
                    </tr>
                </table>
            </div>

            <!-- ì„œëª… -->
            <div class="signature-section">
                <p>ìœ„ì™€ ê°™ì´ ë¶„ì„ì„ ì‹ ì²­í•©ë‹ˆë‹¤.</p>
                <p>ì‹ ì²­ì¼: <input type="date" name="signature_date" style="border:none; border-bottom:1px solid #000; background:transparent;"></p>
                
                <!-- ê°œì„ ëœ ì„œëª…ë€ -->
                <div class="signature-container">
                    <p><strong>ì‹ ì²­ì ì„œëª…:</strong></p>
                    
                    <!-- ì„œëª… ë°©ì‹ ì„ íƒ -->
                    <div class="signature-method">
                        <label>
                            <input type="radio" name="signature_method" value="text" checked>
                            í…ìŠ¤íŠ¸ ì„œëª…
                        </label>
                        <label>
                            <input type="radio" name="signature_method" value="draw">
                            ë””ì§€í„¸ ì„œëª…
                        </label>
            </div>

                    <!-- í…ìŠ¤íŠ¸ ì„œëª… -->
                    <div id="text-signature" class="signature-input">
                        <input type="text" name="signature_name" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        <div class="signature-confirm">
                            <label>
                                <input type="checkbox" name="signature_confirm" required>
                                ìœ„ ë‚´ìš©ì´ ì‚¬ì‹¤ì„ì„ í™•ì¸í•˜ë©°, <strong>ã€Œì•ˆì¬ìš°ã€</strong>ê°€ ì§ì ‘ ì„œëª…í•©ë‹ˆë‹¤.
                            </label>
                        </div>
                    </div>
                    
                    <!-- ë””ì§€í„¸ ì„œëª… íŒ¨ë“œ -->
                    <div id="draw-signature" class="signature-input" style="display: none;">
                        <canvas id="signature-pad" width="400" height="150" style="border: 1px solid #ccc; background: white;"></canvas>
                        <div class="signature-controls">
                            <button type="button" id="clear-signature">ì§€ìš°ê¸°</button>
                            <button type="button" id="save-signature">ì„œëª… ì™„ë£Œ</button>
                        </div>
                        <input type="hidden" name="signature_data" id="signature-data">
                    </div>
                </div>
                
                <!-- ì œì¶œ ë²„íŠ¼ (PDF ìº¡ì²˜ ì‹œ ìˆ¨ê¹€ ì²˜ë¦¬) -->
                <div class="submit-section" id="submit-section" style="margin-top: 30px; text-align: center;">
                    <button type="button" id="submit-application" class="submit-btn" style="background: #007bff; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">
                        ğŸ“§ ì‹ ì²­ì„œ ì œì¶œ (ì´ë©”ì¼ ë°œì†¡)
                    </button>
                </div>
            </div>

        </form>

        <div class="form-footer">
            <p><strong>ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„°</strong></p>
            <p>ì£¼ì†Œ: (50612)ê²½ìƒë‚¨ë„ ì–‘ì‚°ì‹œ ë¬¼ê¸ˆì ë¶€ì‚°ëŒ€í•™ë¡œ 49, ë¶€ì‚°ëŒ€í•™êµ ì–‘ì‚°ìº í¼ìŠ¤ ì²¨ë‹¨ì˜ìƒëª…ìœµí•©ì„¼í„° 202í˜¸</p>
            <p>ì „í™”: 051-510-8057, 8525 | ì´ë©”ì¼: histopath.pnu@gmail.com</p>
        </div>

        <div style="text-align: center; margin-top: 15px; padding: 10px; background-color: #e8f4fd; border-radius: 5px; font-size: 14px; color: #2c5282;">
            ğŸ’¡ <strong>ì•ˆë‚´:</strong> ì‹ ì²­ì„œ ì œì¶œ í›„ ë°œì†¡ëœ ì´ë©”ì¼ì—ì„œ ì‹ ì²­ì„œ ë‚´ìš©ì„ í™•ì¸í•˜ê³  í•„ìš”ì‹œ ì¸ì‡„í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
    </div>

    <script>
        // ì´ ìˆ˜ëŸ‰ ìë™ ê³„ì‚°
        document.addEventListener('DOMContentLoaded', function() {
            const rows = document.querySelectorAll('#servicesTableBody tr');
            
            rows.forEach((row, index) => {
                const sampleInput = row.querySelector(`input[name="sample_count_${index + 1}"]`);
                const slideInput = row.querySelector(`input[name="slide_count_${index + 1}"]`);
                const totalInput = row.querySelector(`input[name="total_count_${index + 1}"]`);
                
                if (sampleInput && slideInput && totalInput) {
                    function calculateTotal() {
                        const sampleCount = parseInt(sampleInput.value) || 0;
                        const slideCount = parseInt(slideInput.value) || 0;
                        totalInput.value = sampleCount * slideCount;
                    }
                    
                    sampleInput.addEventListener('input', calculateTotal);
                    slideInput.addEventListener('input', calculateTotal);
                }
            });
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ìë™ ì…ë ¥
            const today = new Date().toISOString().split('T')[0];
            const applicationDateInput = document.querySelector('input[name="application_date"]');
            applicationDateInput.value = today;
            document.querySelector('input[name="signature_date"]').value = today;
            
            // ì ‘ìˆ˜ë²ˆí˜¸ ìë™ ìƒì„±
            generateReceiptNumber(today);
            
            // ì‹ ì²­ì¼ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ì ‘ìˆ˜ë²ˆí˜¸ ì¬ìƒì„±
            applicationDateInput.addEventListener('change', function() {
                generateReceiptNumber(this.value);
            });
            
            // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë°ì´í„° ê°€ì ¸ì™€ì„œ ìë™ ì…ë ¥
            loadDataFromURL();
            
            // ì„œëª… ì‹œìŠ¤í…œ ì´ˆê¸°í™”
            initSignatureSystem();
        });

        // ğŸ”’ ì¤‘ë³µ ë°©ì§€ ì ‘ìˆ˜ë²ˆí˜¸ ìë™ ìƒì„± í•¨ìˆ˜ (ì‹¤ì œ ìš´ì˜ìš©)
        function generateReceiptNumber(dateString) {
            if (!dateString) return;
            
            // ë‚ ì§œë¥¼ YYMMDD í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            const date = new Date(dateString);
            const year = date.getFullYear().toString().slice(-2);
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const datePrefix = year + month + day;
            
            // ğŸ“ ë°©ë²• 1: íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ ê³ ìœ  ë²ˆí˜¸ ìƒì„±
            const now = new Date();
            const timestamp = now.getTime(); // ë°€ë¦¬ì´ˆ ë‹¨ìœ„ íƒ€ì„ìŠ¤íƒ¬í”„
            const timeString = now.getHours().toString().padStart(2, '0') + 
                             now.getMinutes().toString().padStart(2, '0') + 
                             now.getSeconds().toString().padStart(2, '0');
            
            // ğŸ“ ë°©ë²• 2: ë¸Œë¼ìš°ì € ê³ ìœ  ì‹ë³„ì ìƒì„± (ì„¸ì…˜ë³„ êµ¬ë¶„)
            let sessionId = localStorage.getItem('browserSessionId');
            if (!sessionId) {
                // ëœë¤ 3ìë¦¬ + í˜„ì¬ ì‹œê°„ ì¡°í•©ìœ¼ë¡œ ì„¸ì…˜ ID ìƒì„±
                sessionId = Math.floor(Math.random() * 900 + 100).toString() + 
                           (timestamp % 1000).toString().padStart(3, '0');
                localStorage.setItem('browserSessionId', sessionId);
            }
            
            // ğŸ“ ë°©ë²• 3: ì—°ì†ì  ì¹´ìš´í„° ê´€ë¦¬ (ë‚ ì§œê°€ ë°”ë€Œì–´ë„ ê³„ì† ì¦ê°€)
            const globalCounterKey = 'globalReceiptCounter';
            let globalCounter = parseInt(localStorage.getItem(globalCounterKey) || '0') + 1;
            localStorage.setItem(globalCounterKey, globalCounter.toString());
            
            // ğŸ“ ë°©ë²• 4: í•˜ì´ë¸Œë¦¬ë“œ ê³ ìœ  ë²ˆí˜¸ ìƒì„±
            // ë‚´ë¶€ìš©: YYMMDD-HHMMSS-XXX (ì‹œë¶„ì´ˆ í¬í•¨ìœ¼ë¡œ ì¤‘ë³µ ë°©ì§€)
            const internalReceiptNumber = datePrefix + '-' + timeString + '-' + globalCounter.toString().padStart(3, '0');
            
            // ğŸ“ ë°©ë²• 5: ì¤‘ë³µ ê²€ì¦ ë° ì¬ìƒì„±
            const usedNumbers = JSON.parse(localStorage.getItem('usedReceiptNumbers') || '[]');
            let finalInternalNumber = internalReceiptNumber;
            let attempt = 0;
            
            while (usedNumbers.includes(finalInternalNumber) && attempt < 10) {
                attempt++;
                finalInternalNumber = datePrefix + '-' + timeString + '-' + (globalCounter + attempt).toString().padStart(3, '0');
            }
            
            // ì‚¬ìš©ëœ ë²ˆí˜¸ ëª©ë¡ì— ì¶”ê°€ (ìµœê·¼ 1000ê°œë§Œ ë³´ê´€)
            usedNumbers.push(finalInternalNumber);
            if (usedNumbers.length > 1000) {
                usedNumbers.splice(0, usedNumbers.length - 1000);
            }
            localStorage.setItem('usedReceiptNumbers', JSON.stringify(usedNumbers));
            
            // ğŸ“ ë°©ë²• 6: ì‚¬ìš©ììš© ê°„ë‹¨í•œ í‘œì‹œ ë²ˆí˜¸ ìƒì„±
            // í‘œì‹œìš©: YYMMDD-XXX (ê°„ë‹¨í•˜ê³  ë³´ê¸° ì¢‹ê²Œ)
            const displayReceiptNumber = datePrefix + '-' + (globalCounter + attempt).toString().padStart(3, '0');
            
            // ì ‘ìˆ˜ë²ˆí˜¸ ì…ë ¥ë€ì— í‘œì‹œìš© ë²ˆí˜¸ ì„¤ì •
            const receiptInput = document.getElementById('receipt_number_top');
            if (receiptInput) {
                receiptInput.value = displayReceiptNumber;
                // ë‚´ë¶€ ì²˜ë¦¬ìš© ì „ì²´ ë²ˆí˜¸ëŠ” ë°ì´í„° ì†ì„±ì— ì €ì¥
                receiptInput.setAttribute('data-internal-number', finalInternalNumber);
            }
            
            console.log('ğŸ‘ï¸ ì‚¬ìš©ì í‘œì‹œ ë²ˆí˜¸:', displayReceiptNumber);
            console.log('ğŸ”’ ë‚´ë¶€ ì²˜ë¦¬ ë²ˆí˜¸:', finalInternalNumber);
            console.log('ğŸ“Š ë¸Œë¼ìš°ì € ì„¸ì…˜ ID:', sessionId);
            console.log('ğŸ“ˆ ì—°ì† ì¹´ìš´í„°:', globalCounter);
        }

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë°ì´í„° ë¡œë“œí•˜ì—¬ í¼ì— ìë™ ì…ë ¥
        function loadDataFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            
            console.log('URL íŒŒë¼ë¯¸í„°:', window.location.search);
            
            // ê°œë³„ íŒŒë¼ë¯¸í„°ë“¤ì„ ì§ì ‘ ì½ì–´ì„œ í¼ì— ì…ë ¥
            const name = urlParams.get('name');
            const institution = urlParams.get('institution');
            const department = urlParams.get('department');
            const email = urlParams.get('email');
            const phone = urlParams.get('phone');
            const sampleName = urlParams.get('sampleName');
            const specialRequests = urlParams.get('specialRequests');
            const sampleType = urlParams.get('sampleType');
            const fixative = urlParams.get('fixative');
                
                // ì‹ ì²­ì ì •ë³´ ìë™ ì…ë ¥
            if (name) {
                const nameInput = document.querySelector('input[name="applicant_name"]');
                if (nameInput) {
                    nameInput.value = decodeURIComponent(name);
                    console.log('ì´ë¦„ ì…ë ¥:', decodeURIComponent(name));
                }
            }
            if (institution) {
                const institutionInput = document.querySelector('input[name="institution"]');
                if (institutionInput) {
                    institutionInput.value = decodeURIComponent(institution);
                    console.log('ì†Œì†ê¸°ê´€ ì…ë ¥:', decodeURIComponent(institution));
                }
            }
            if (department) {
                const departmentInput = document.querySelector('input[name="department"]');
                if (departmentInput) {
                    departmentInput.value = decodeURIComponent(department);
                    console.log('ë¶€ì„œ ì…ë ¥:', decodeURIComponent(department));
                }
            }
            if (email) {
                const emailInput = document.querySelector('input[name="email"]');
                if (emailInput) {
                    emailInput.value = decodeURIComponent(email);
                    console.log('ì´ë©”ì¼ ì…ë ¥:', decodeURIComponent(email));
                }
            }
            if (phone) {
                const phoneInput = document.querySelector('input[name="phone"]');
                if (phoneInput) {
                    phoneInput.value = decodeURIComponent(phone);
                    console.log('ì „í™”ë²ˆí˜¸ ì…ë ¥:', decodeURIComponent(phone));
                }
            }
            if (sampleName) {
                const sampleNameInput = document.querySelector('textarea[name="sample_name"]');
                if (sampleNameInput) {
                    sampleNameInput.value = decodeURIComponent(sampleName);
                    console.log('ê²€ì²´ëª… ì…ë ¥:', decodeURIComponent(sampleName));
                }
            }
            if (specialRequests) {
                const specialRequestsInput = document.querySelector('textarea[name="special_requests"]');
                if (specialRequestsInput) {
                    specialRequestsInput.value = decodeURIComponent(specialRequests);
                    console.log('íŠ¹ë³„ìš”ì²­ì‚¬í•­ ì…ë ¥:', decodeURIComponent(specialRequests));
                }
                }
                
                // ê²€ì²´ ì¢…ë¥˜ ìë™ ì„ íƒ
            if (sampleType) {
                console.log('ê²€ì²´ ì¢…ë¥˜:', sampleType);
                if (sampleType === 'tissue') {
                    const checkbox = document.getElementById('tissue');
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log('ì¡°ì§ ì²´í¬ë°•ìŠ¤ ì„ íƒë¨');
                    }
                } else if (sampleType === 'cell') {
                    const checkbox = document.getElementById('cell');
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log('ì„¸í¬ ì²´í¬ë°•ìŠ¤ ì„ íƒë¨');
                    }
                }
            }
                
                // ê³ ì •ì•¡ ìë™ ì„ íƒ
            if (fixative) {
                console.log('ê³ ì •ì•¡:', fixative);
                if (fixative === 'nbf') {
                    const checkbox = document.getElementById('nbf');
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log('NBF ì²´í¬ë°•ìŠ¤ ì„ íƒë¨');
                    }
                } else if (fixative === 'alcohol') {
                    const checkbox = document.getElementById('alcohol');
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log('Alcohol ì²´í¬ë°•ìŠ¤ ì„ íƒë¨');
                    }
                }
            }
            
            // ì„œë¹„ìŠ¤ ìë™ ì„ íƒ ë° í…Œì´ë¸” ìë™ ì…ë ¥
            const services = urlParams.get('services');
            if (services) {
                console.log('ì„œë¹„ìŠ¤ íŒŒë¼ë¯¸í„° ë°œê²¬:', services);
                
                // ICC ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ
                const iccCheckbox = document.getElementById('icc');
                
                if (iccCheckbox) {
                    iccCheckbox.checked = true;
                    console.log('ICC ì²´í¬ë°•ìŠ¤ ì„ íƒë¨');
                }
                
                // ì„œë¹„ìŠ¤ í…Œì´ë¸” ìë™ ì…ë ¥
                fillServiceTableWithBasicData();
            }
            
            // ì„œë¹„ìŠ¤ í…Œì´ë¸” ìë™ ì…ë ¥ í•¨ìˆ˜ (ì´ì „ ì‘ë™ ë°©ì‹ìœ¼ë¡œ ë³µì›)
            function fillServiceTableWithBasicData() {
                console.log('ì„œë¹„ìŠ¤ í…Œì´ë¸” ìë™ ì…ë ¥ ì‹œì‘');
                
                // ì²« ë²ˆì§¸ í–‰: ë©´ì—­ì„¸í¬í™”í•™ì—¼ìƒ‰ (ICC)
                const row1SampleCount = document.querySelector('input[name="sample_count_1"]');
                const row1ServiceName = document.querySelector('input[name="service_name_1"]');
                const row1AntibodyType = document.querySelector('input[name="antibody_type_1"]');
                const row1SlideCount = document.querySelector('input[name="slide_count_1"]');
                const row1TotalCount = document.querySelector('input[name="total_count_1"]');
                const row1Note = document.querySelector('input[name="note_1"]');
                
                if (row1SampleCount) {
                    row1SampleCount.value = '1';
                    console.log('ê²€ì²´ìˆ˜ 1 ì…ë ¥: 1');
                }
                
                if (row1ServiceName) {
                    row1ServiceName.value = 'ë©´ì—­ì„¸í¬í™”í•™ì—¼ìƒ‰ (ICC)';
                    console.log('ì˜ë¢°ë¶„ì„ 1 ì…ë ¥: ë©´ì—­ì„¸í¬í™”í•™ì—¼ìƒ‰ (ICC)');
                }
                
                if (row1AntibodyType) {
                    row1AntibodyType.value = 'ë‹¨ì¼ ë§ˆì»¤';
                    console.log('ì„¸ë¶€ë¶„ì„ 1 ì…ë ¥: ë‹¨ì¼ ë§ˆì»¤');
                }
                
                if (row1SlideCount) {
                    row1SlideCount.value = '1';
                    console.log('ìŠ¬ë¼ì´ë“œìˆ˜ 1 ì…ë ¥: 1');
                }
                
                if (row1TotalCount) {
                    row1TotalCount.value = '1';
                    console.log('ì˜ë¢°ì´ìˆ˜ëŸ‰ 1 ì…ë ¥: 1');
                }
                
                if (row1Note) {
                    row1Note.value = 'ê¸°ë³¸';
                    console.log('ë¹„ê³  1 ì…ë ¥: ê¸°ë³¸');
                }
                
                console.log('ë©´ì—­ì„¸í¬í™”í•™ì—¼ìƒ‰ (ICC) ì„œë¹„ìŠ¤ê°€ ìë™ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
            
            // ğŸ†• URLì—ì„œ í…Œì´ë¸” ë°ì´í„° ìë™ ì…ë ¥
            loadTableDataFromURL(urlParams);
            
            // ğŸ†• ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ ì²˜ë¦¬
            autoSelectCheckboxesFromURL(urlParams);
            
            // ìë™ ì…ë ¥ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ (íŒŒë¼ë¯¸í„°ê°€ ìˆì„ ë•Œë§Œ)
            if (name || institution || department || email || phone || sampleName || specialRequests) {
                showAutoFillMessage();
            }
        }
        
        // ğŸ†• URLì—ì„œ í…Œì´ë¸” ë°ì´í„° ìë™ ì…ë ¥ í•¨ìˆ˜
        function loadTableDataFromURL(urlParams) {
            console.log('ğŸ”„ í…Œì´ë¸” ë°ì´í„° ìë™ ì…ë ¥ ì‹œì‘');
            
            // ìµœëŒ€ 4ê°œ í–‰ê¹Œì§€ ì²˜ë¦¬
            for (let i = 1; i <= 4; i++) {
                const sampleCount = urlParams.get(`sample_count_${i}`);
                const serviceName = urlParams.get(`service_name_${i}`);
                const antibodyType = urlParams.get(`antibody_type_${i}`);
                const slideCount = urlParams.get(`slide_count_${i}`);
                const totalCount = urlParams.get(`total_count_${i}`);
                const note = urlParams.get(`note_${i}`);
                
                // í•´ë‹¹ í–‰ì— ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì…ë ¥
                if (sampleCount || serviceName || antibodyType || slideCount || totalCount || note) {
                    console.log(`ğŸ“ í–‰ ${i} ë°ì´í„° ë°œê²¬:`, {sampleCount, serviceName, antibodyType, slideCount, totalCount, note});
                    
                    // ê° í•„ë“œì— ë°ì´í„° ì…ë ¥
                    if (sampleCount) {
                        const input = document.querySelector(`input[name="sample_count_${i}"]`);
                        if (input) {
                            input.value = decodeURIComponent(sampleCount);
                            console.log(`âœ… ê²€ì²´ìˆ˜ ${i}: ${decodeURIComponent(sampleCount)}`);
                        }
                    }
                    
                    if (serviceName) {
                        const input = document.querySelector(`input[name="service_name_${i}"]`);
                        if (input) {
                            input.value = decodeURIComponent(serviceName);
                            console.log(`âœ… ì„œë¹„ìŠ¤ëª… ${i}: ${decodeURIComponent(serviceName)}`);
                        }
                    }
                    
                    if (antibodyType) {
                        const input = document.querySelector(`input[name="antibody_type_${i}"]`);
                        if (input) {
                            input.value = decodeURIComponent(antibodyType);
                            console.log(`âœ… ì„¸ë¶€ë¶„ì„ ${i}: ${decodeURIComponent(antibodyType)}`);
                        }
                    }
                    
                    if (slideCount) {
                        const input = document.querySelector(`input[name="slide_count_${i}"]`);
                        if (input) {
                            input.value = decodeURIComponent(slideCount);
                            console.log(`âœ… ìŠ¬ë¼ì´ë“œìˆ˜ ${i}: ${decodeURIComponent(slideCount)}`);
                        }
                    }
                    
                    if (totalCount) {
                        const input = document.querySelector(`input[name="total_count_${i}"]`);
                        if (input) {
                            input.value = decodeURIComponent(totalCount);
                            console.log(`âœ… ì´ìˆ˜ëŸ‰ ${i}: ${decodeURIComponent(totalCount)}`);
                        }
                    }
                    
                    if (note) {
                        const input = document.querySelector(`input[name="note_${i}"]`);
                        if (input) {
                            input.value = decodeURIComponent(note);
                            console.log(`âœ… ë¹„ê³  ${i}: ${decodeURIComponent(note)}`);
                        }
                    }
                }
            }
            
            console.log('âœ… í…Œì´ë¸” ë°ì´í„° ìë™ ì…ë ¥ ì™„ë£Œ');
        }
        
        // ğŸ†• URLì—ì„œ ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ í•¨ìˆ˜
        function autoSelectCheckboxesFromURL(urlParams) {
            console.log('ğŸ”„ ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ ì‹œì‘');
            
            // ê²€ì²´ ì¢…ë¥˜ ì²´í¬ë°•ìŠ¤ë“¤
            const sampleTypes = ['tissue', 'cell', 'other'];
            sampleTypes.forEach(type => {
                const param = urlParams.get(`sample_type_${type}`);
                if (param === 'on' || param === 'true' || param === '1') {
                    const checkbox = document.getElementById(type);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`âœ… ê²€ì²´ ì¢…ë¥˜ ${type} ì„ íƒë¨`);
                    }
                }
            });
            
            // ê³ ì •ì•¡ ì²´í¬ë°•ìŠ¤ë“¤ 
            const fixatives = ['nbf', 'alcohol', 'other'];
            fixatives.forEach(fixative => {
                const param = urlParams.get(`fixative_${fixative}`);
                if (param === 'on' || param === 'true' || param === '1') {
                    const checkbox = document.getElementById(fixative);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`âœ… ê³ ì •ì•¡ ${fixative} ì„ íƒë¨`);
                    }
                }
            });
            
            // ê¸°ë³¸ ë¶„ì„ ì²´í¬ë°•ìŠ¤ë“¤
            const analyses = ['paraffin', 'frozen', 'pas', 'masson', 'alcian_blue', 'pico_sirius_red', 
                            'ihc', 'icc', 'if_staining', 'fish', 'dna_extraction', 'rna_extraction', 'tma'];
            analyses.forEach(analysis => {
                const param = urlParams.get(analysis);
                if (param === 'on' || param === 'true' || param === '1') {
                    const checkbox = document.getElementById(analysis);
                    if (checkbox) {
                        checkbox.checked = true;
                        console.log(`âœ… ë¶„ì„ ${analysis} ì„ íƒë¨`);
                    }
                }
            });
            
            console.log('âœ… ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ ì™„ë£Œ');
        }

                 // ì„œë¹„ìŠ¤ë³„ ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ
         function autoSelectServiceCheckboxes(services) {
             const serviceMapping = {
                 'íŒŒë¼í•€ í¬ë§¤': 'paraffin',
                 'ë™ê²°ì ˆí¸': 'frozen',
                 'íŠ¹ìˆ˜ì—¼ìƒ‰': 'pas', // íŠ¹ìˆ˜ì—¼ìƒ‰ì˜ ê²½ìš° ëŒ€í‘œë¡œ PAS ì„ íƒ
                 'ë©´ì—­ì¡°ì§í™”í•™ì—¼ìƒ‰ (IHC)': 'ihc',
                 'ë©´ì—­ì„¸í¬í™”í•™ì—¼ìƒ‰ (ICC)': 'icc',
                 'ë©´ì—­í˜•ê´‘ì—¼ìƒ‰ (IF)': 'if_staining',
                 'í˜•ê´‘ì œìë¦¬ë¶€í•©ë²• (FISH)': 'fish',
                 'Tissue Microarray (TMA)': 'tma',
                 'DNA/RNA ì¶”ì¶œ': 'dna_extraction',
                 'Alcian Blue ì—¼ìƒ‰': 'alcian_blue',
                 'Pico Sirius Red ì—¼ìƒ‰': 'pico_sirius_red'
             };

            services.forEach(service => {
                const checkboxId = serviceMapping[service.mainService];
                if (checkboxId) {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                }
            });
        }

        // ì„œë¹„ìŠ¤ í…Œì´ë¸”ì— ë°ì´í„° ìë™ ì…ë ¥
        function fillServiceTable(services) {
            const tableBody = document.getElementById('servicesTableBody');
            const rows = tableBody.querySelectorAll('tr');
            
            services.forEach((service, index) => {
                if (index < rows.length) {
                    const row = rows[index];
                    
                    // ê²€ì²´ ìˆ˜
                    const sampleCountInput = row.querySelector(`input[name="sample_count_${index + 1}"]`);
                    if (sampleCountInput) {
                        sampleCountInput.value = service.sampleCount;
                    }
                    
                    // ì„œë¹„ìŠ¤ëª…
                    const serviceNameInput = row.querySelector(`input[name="service_name_${index + 1}"]`);
                    if (serviceNameInput) {
                        serviceNameInput.value = service.mainService;
                    }
                    
                    // ì„¸ë¶€ ì„œë¹„ìŠ¤
                    const antibodyTypeInput = row.querySelector(`input[name="antibody_type_${index + 1}"]`);
                    if (antibodyTypeInput && service.subService) {
                        antibodyTypeInput.value = service.subService;
                    }
                    
                    // ìŠ¬ë¼ì´ë“œ ìˆ˜
                    const slideCountInput = row.querySelector(`input[name="slide_count_${index + 1}"]`);
                    if (slideCountInput) {
                        slideCountInput.value = service.slideCount;
                    }
                    
                    // ì´ ìˆ˜ëŸ‰ (ìë™ ê³„ì‚°)
                    const totalCountInput = row.querySelector(`input[name="total_count_${index + 1}"]`);
                    if (totalCountInput) {
                        totalCountInput.value = service.totalCount || (parseInt(service.sampleCount) * parseInt(service.slideCount));
                    }
                }
            });
        }

        // ìë™ ì…ë ¥ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
        function showAutoFillMessage() {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: #28a745;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                z-index: 1000;
                font-size: 14px;
            `;
            message.innerHTML = 'âœ… ì˜¨ë¼ì¸ ì‹ ì²­ ë‚´ìš©ì´ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤!';
            
            document.body.appendChild(message);
            
            // 3ì´ˆ í›„ ë©”ì‹œì§€ ì œê±°
            setTimeout(() => {
                document.body.removeChild(message);
            }, 3000);
        }

        // ì„œëª… ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        function initSignatureSystem() {
            const textSignatureDiv = document.getElementById('text-signature');
            const drawSignatureDiv = document.getElementById('draw-signature');
            const signatureMethodRadios = document.querySelectorAll('input[name="signature_method"]');
            const canvas = document.getElementById('signature-pad');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;

            // ì„œëª… ë°©ì‹ ë³€ê²½ ì´ë²¤íŠ¸
            signatureMethodRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'text') {
                        textSignatureDiv.style.display = 'block';
                        drawSignatureDiv.style.display = 'none';
                    } else {
                        textSignatureDiv.style.display = 'none';
                        drawSignatureDiv.style.display = 'block';
                    }
                });
            });

            // ì‹ ì²­ì ì´ë¦„ ìë™ ì…ë ¥ ì‹œ ì„œëª… í™•ì¸ë€ ì—…ë°ì´íŠ¸
            const signatureNameInput = document.querySelector('input[name="signature_name"]');
            const signatureConfirmLabel = document.querySelector('.signature-confirm label');
            
            if (signatureNameInput && signatureConfirmLabel) {
                signatureNameInput.addEventListener('input', function() {
                    const name = this.value || 'ì‹ ì²­ì';
                    signatureConfirmLabel.innerHTML = `
                        <input type="checkbox" name="signature_confirm" required>
                        ìœ„ ë‚´ìš©ì´ ì‚¬ì‹¤ì„ì„ í™•ì¸í•˜ë©°, <strong>ã€Œ${name}ã€</strong>ê°€ ì§ì ‘ ì„œëª…í•©ë‹ˆë‹¤.
                    `;
                });
            }

            // ë””ì§€í„¸ ì„œëª… íŒ¨ë“œ ê¸°ëŠ¥
            if (canvas) {
                // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('mouseout', stopDrawing);

                // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼)
                canvas.addEventListener('touchstart', handleTouch);
                canvas.addEventListener('touchmove', handleTouch);
                canvas.addEventListener('touchend', stopDrawing);

                function startDrawing(e) {
                    isDrawing = true;
                    draw(e);
                }

                function draw(e) {
                    if (!isDrawing) return;

                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    ctx.lineWidth = 2;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = '#000';

                    ctx.lineTo(x, y);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                }

                function stopDrawing() {
                    if (isDrawing) {
                        isDrawing = false;
                        ctx.beginPath();
                        // ì„œëª… ë°ì´í„°ë¥¼ hidden inputì— ì €ì¥
                        document.getElementById('signature-data').value = canvas.toDataURL();
                    }
                }

                function handleTouch(e) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                     e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    });
                    canvas.dispatchEvent(mouseEvent);
                }

                // ì„œëª… ì§€ìš°ê¸°
                document.getElementById('clear-signature').addEventListener('click', function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    document.getElementById('signature-data').value = '';
                });

                // ì„œëª… ì™„ë£Œ
                document.getElementById('save-signature').addEventListener('click', function() {
                    if (document.getElementById('signature-data').value) {
                        alert('ì„œëª…ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        alert('ì„œëª…ì„ ë¨¼ì € ì‘ì„±í•´ì£¼ì„¸ìš”.');
                    }
                });
            }

            // ì‹ ì²­ì„œ ì œì¶œ ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('submit-application').addEventListener('click', function() {
                if (validateSignature()) {
                    submitApplication();
                }
            });
        }

        // ì„œëª… ê²€ì¦
        function validateSignature() {
            const signatureMethod = document.querySelector('input[name="signature_method"]:checked').value;
            
            if (signatureMethod === 'text') {
                const signatureName = document.querySelector('input[name="signature_name"]').value;
                const signatureConfirm = document.querySelector('input[name="signature_confirm"]').checked;
                
                if (!signatureName) {
                    alert('ì„±ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return false;
                }
                if (!signatureConfirm) {
                    alert('ì„œëª… í™•ì¸ë€ì— ì²´í¬í•´ì£¼ì„¸ìš”.');
                    return false;
                }
            } else {
                const signatureData = document.getElementById('signature-data').value;
                if (!signatureData) {
                    alert('ë””ì§€í„¸ ì„œëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.');
                    return false;
                }
            }
            
            return true;
        }

        // ğŸ“¸ ì‹ ì²­ì„œ ì´ë¯¸ì§€ ìƒì„± (html2canvas ì‚¬ìš©)
        function generateApplicationImage() {
            return new Promise((resolve, reject) => {
                console.log('ğŸ¯ [ìë™í™” ì‹œìŠ¤í…œ] ì´ë¯¸ì§€ ìƒì„± ì‹œì‘');
                console.log('ğŸ“¸ ì‹ ì²­ì„œ ì´ë¯¸ì§€ ìƒì„± ì‹œì‘...');
                
                // html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ ë™ì  ë¡œë“œ
                if (typeof html2canvas === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                    script.onload = function() {
                        generateImageWithHtml2Canvas(resolve, reject);
                    };
                    script.onerror = function() {
                        console.log('ğŸ“¸ html2canvas ë¡œë“œ ì‹¤íŒ¨, í´ë°± ì´ë¯¸ì§€ ìƒì„±');
                        const fallbackImage = generateFallbackApplicationImage();
                        resolve(fallbackImage);
                    };
                    document.head.appendChild(script);
                } else {
                    generateImageWithHtml2Canvas(resolve, reject);
                }
            });
        }

        // ğŸ“„ ì‹ ì²­ì„œ PDF ìƒì„± (ì´ë¯¸ì§€ ê¸°ë°˜)
        function generateApplicationPDF(imageDataUrl, receiptNumber) {
            return new Promise((resolve, reject) => {
                console.log('ğŸ“„ PDF ìƒì„± ì‹œì‘...');
                
                // jsPDF ë¼ì´ë¸ŒëŸ¬ë¦¬ ë™ì  ë¡œë“œ
                if (typeof window.jspdf === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                    script.onload = function() {
                        createPDFFromImage(imageDataUrl, receiptNumber, resolve, reject);
                    };
                    script.onerror = function() {
                        console.log('ğŸ“„ jsPDF ë¡œë“œ ì‹¤íŒ¨');
                        reject(new Error('PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨'));
                    };
                    document.head.appendChild(script);
                } else {
                    createPDFFromImage(imageDataUrl, receiptNumber, resolve, reject);
                }
            });
        }

        // PDF íŒŒì¼ ìƒì„± ì‹¤í–‰
        function createPDFFromImage(imageDataUrl, receiptNumber, resolve, reject) {
            try {
                const { jsPDF } = window.jspdf;
                
                // A4 í¬ê¸°ì˜ PDF ë¬¸ì„œ ìƒì„±
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                // ì´ë¯¸ì§€ë¥¼ PDFì— ì¶”ê°€
                const imgWidth = 210; // A4 ë„ˆë¹„ (mm)
                const imgHeight = 297; // A4 ë†’ì´ (mm)
                
                pdf.addImage(imageDataUrl, 'PNG', 0, 0, imgWidth, imgHeight, undefined, 'FAST');
                
                // PDF ë°ì´í„° ìƒì„±
                const pdfBlob = pdf.output('blob');
                const pdfDataUrl = URL.createObjectURL(pdfBlob);
                
                console.log('âœ… PDF ìƒì„± ì™„ë£Œ');
                
                resolve({
                    pdfBlob: pdfBlob,
                    pdfDataUrl: pdfDataUrl,
                    filename: `ì‹ ì²­ì„œ_${receiptNumber}.pdf`
                });
                
            } catch (error) {
                console.error('âŒ PDF ìƒì„± ì˜¤ë¥˜:', error);
                reject(error);
            }
        }
        
        // html2canvasë¥¼ ì‚¬ìš©í•œ ê³ í’ˆì§ˆ ì´ë¯¸ì§€ ìƒì„±
        function generateImageWithHtml2Canvas(resolve, reject) {
            const element = document.querySelector('.application-form');
            
            const options = {
                allowTaint: true,
                useCORS: true,
                scale: 2, // ê³ í•´ìƒë„
                backgroundColor: '#ffffff',
                width: element.scrollWidth,
                height: element.scrollHeight,
                scrollX: 0,
                scrollY: 0,
                logging: false,
                imageTimeout: 15000
            };
            
            html2canvas(element, options)
                .then(canvas => {
                    const imageDataUrl = canvas.toDataURL('image/png', 0.95);
                    console.log('âœ… html2canvas ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ');
                    resolve(imageDataUrl);
                })
                .catch(error => {
                    console.log('ğŸ“¸ html2canvas ì‹¤í–‰ ì‹¤íŒ¨, í´ë°± ì´ë¯¸ì§€ ìƒì„±');
                    const fallbackImage = generateFallbackApplicationImage();
                    resolve(fallbackImage);
                });
        }

        // í´ë°± ì‹ ì²­ì„œ ì´ë¯¸ì§€ ìƒì„± (Canvas ê¸°ë°˜)
        function generateFallbackApplicationImage() {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 1200;
            const ctx = canvas.getContext('2d');
            
            // ë°°ê²½
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // í—¤ë”
            ctx.fillStyle = '#005baa';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„°', canvas.width/2, 40);
            ctx.font = 'bold 18px Arial';
            ctx.fillText('ì„œë¹„ìŠ¤ ì‹ ì²­ì„œ', canvas.width/2, 70);
            
            // ì ‘ìˆ˜ë²ˆí˜¸
            // ì‚¬ìš©ììš© í‘œì‹œ ë²ˆí˜¸ì™€ ë‚´ë¶€ ì²˜ë¦¬ìš© ë²ˆí˜¸ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°
        const receiptInput = document.getElementById('receipt_number_top');
        const displayReceiptNumber = receiptInput?.value || 'AUTO-' + Date.now();
        const internalReceiptNumber = receiptInput?.getAttribute('data-internal-number') || displayReceiptNumber;
            ctx.font = '14px Arial';
            ctx.fillText(`ì ‘ìˆ˜ë²ˆí˜¸: ${displayReceiptNumber}`, canvas.width/2, 100);
            
            // ì‹ ì²­ì ì •ë³´
            ctx.fillStyle = '#000000';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            
            let yPos = 130;
            const lineHeight = 20;
            
            ctx.fillText(`ì‹ ì²­ì: ${document.querySelector('input[name="applicant_name"]')?.value || ''}`, 50, yPos += lineHeight);
            ctx.fillText(`ì†Œì†: ${document.querySelector('input[name="institution"]')?.value || ''}`, 50, yPos += lineHeight);
            ctx.fillText(`ë¶€ì„œ: ${document.querySelector('input[name="department"]')?.value || ''}`, 50, yPos += lineHeight);
            ctx.fillText(`ì´ë©”ì¼: ${document.querySelector('input[name="email"]')?.value || ''}`, 50, yPos += lineHeight);
            ctx.fillText(`ì—°ë½ì²˜: ${document.querySelector('input[name="phone"]')?.value || ''}`, 50, yPos += lineHeight);
            
            // ì„œë¹„ìŠ¤ ì •ë³´
            yPos += 30;
            ctx.fillStyle = '#005baa';
            ctx.font = 'bold 14px Arial';
            ctx.fillText('ì‹ ì²­ ì„œë¹„ìŠ¤:', 50, yPos += lineHeight);
            
            ctx.fillStyle = '#000000';
            ctx.font = '11px Arial';
            
            for (let i = 1; i <= 4; i++) {
                const sampleCount = document.querySelector(`input[name="sample_count_${i}"]`)?.value;
                const serviceSelect = document.querySelector(`select[name="service_name_${i}"]`);
                const serviceName = serviceSelect?.selectedOptions[0]?.text;
                const slideCount = document.querySelector(`input[name="slide_count_${i}"]`)?.value;
                
                if (sampleCount && serviceName) {
                    ctx.fillText(`${i}. ê²€ì²´: ${sampleCount}ê°œ, ë¶„ì„: ${serviceName}, ìŠ¬ë¼ì´ë“œ: ${slideCount || '-'}ê°œ`, 70, yPos += lineHeight);
                }
            }
            
            // ì„œëª… ì˜ì—­
            yPos += 50;
            ctx.strokeStyle = '#005baa';
            ctx.lineWidth = 2;
            ctx.strokeRect(canvas.width - 200, yPos, 150, 60);
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ì„œëª…', canvas.width - 125, yPos + 35);
            
            // ë‚ ì§œ
            const today = document.querySelector('input[name="signature_date"]')?.value || new Date().toLocaleDateString();
            ctx.fillStyle = '#000';
            ctx.textAlign = 'left';
            ctx.fillText(`ì‹ ì²­ì¼: ${today}`, 50, yPos + 35);
            
            // í•˜ë‹¨ ì •ë³´
            ctx.fillStyle = '#666';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„°', canvas.width/2, canvas.height - 30);
            ctx.fillText('ì „í™”: 051-510-8057, 8525 | ì´ë©”ì¼: histopath.pnu@gmail.com', canvas.width/2, canvas.height - 15);
            
            return canvas.toDataURL('image/png');
        }

        // âœ… ì™„ì „í•œ ì‹ ì²­ì„œ ì œì¶œ í”„ë¡œì„¸ìŠ¤
        function submitApplication() {
            console.log('âœ… ì‹ ì²­ì„œ ì œì¶œ í”„ë¡œì„¸ìŠ¤ ì‹œì‘');
            
            // ì œì¶œ ë²„íŠ¼ ìƒíƒœ ì €ì¥
            const submitBtn = document.getElementById('submit-application');
            const originalText = submitBtn.textContent;
            const originalBackground = submitBtn.style.background;
            
            // ğŸ¯ PDF ìƒì„±ìš©: ì œì¶œ ë²„íŠ¼ ì˜ì—­ ì™„ì „íˆ ìˆ¨ê¹€
            const submitSection = document.getElementById('submit-section');
            submitSection.style.display = 'none';
            
            // 1ë‹¨ê³„: ì´ë¯¸ì§€ ìƒì„± (ì œì¶œ ë²„íŠ¼ ì—†ì´ ê¹”ë”í•˜ê²Œ)
            generateApplicationImage()
                .then(imageDataUrl => {
                    // ğŸ“¤ ì´ë¯¸ì§€ ìƒì„± í›„ ì œì¶œ ë²„íŠ¼ ì˜ì—­ ë‹¤ì‹œ í‘œì‹œí•˜ê³  ì§„í–‰ ìƒíƒœë¡œ ë³€ê²½
                    submitSection.style.display = 'block';
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'ğŸ“¤ ì œì¶œ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”';
                    submitBtn.style.background = '#666';
                    console.log('ğŸ“¸ ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ');
                    
                    // 2ë‹¨ê³„: ë°ì´í„° ìˆ˜ì§‘
                    const applicationData = collectCompleteApplicationData();
                    applicationData.applicationImage = imageDataUrl;
                    
                    // ì„œëª… ë°ì´í„° ì¶”ê°€
                    const signatureMethod = document.querySelector('input[name="signature_method"]:checked').value;
                    if (signatureMethod === 'text') {
                        applicationData.signatureText = document.querySelector('input[name="signature_name"]')?.value;
                        applicationData.signatureType = 'text';
                    } else {
                        applicationData.signatureImage = document.getElementById('signature-data').value;
                        applicationData.signatureType = 'digital';
                    }
                    
                    // 3ë‹¨ê³„: Google Apps Scriptë¡œ ì „ì†¡
                    return sendToGoogleAppsScriptWithImage(applicationData);
                })
                .then(response => {
                    console.log('âœ… ì‹ ì²­ì„œ ì œì¶œ ì™„ë£Œ');
                    showSubmissionSuccess(response);
                })
                .catch(error => {
                    console.error('âŒ ì‹ ì²­ì„œ ì œì¶œ ì˜¤ë¥˜:', error);
                    showSubmissionError(error);
                })
                .finally(() => {
                    // ì œì¶œ ë²„íŠ¼ê³¼ ì˜ì—­ ì›ë˜ ìƒíƒœë¡œ ì™„ì „ ë³µì›
                    submitSection.style.display = 'block';
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText || 'ğŸ“§ ì‹ ì²­ì„œ ì œì¶œ (ì´ë©”ì¼ ë°œì†¡)';
                    submitBtn.style.background = originalBackground || '#007bff';
                });
        }
        
        // ğŸ“Š ì™„ì „í•œ ì‹ ì²­ì„œ ë°ì´í„° ìˆ˜ì§‘
        function collectCompleteApplicationData() {
            const data = {
                // ë©”íƒ€ë°ì´í„°
                receiptNumber: document.getElementById('receipt_number_top')?.getAttribute('data-internal-number') || document.getElementById('receipt_number_top')?.value || 'PNU-' + Date.now(),
            displayReceiptNumber: document.getElementById('receipt_number_top')?.value || 'PNU-' + Date.now(),
                submittedAt: new Date().toISOString(),
                signatureDate: document.querySelector('input[name="signature_date"]')?.value || new Date().toLocaleDateString(),
                
                // ê¸°ë³¸ ì •ë³´
                name: document.querySelector('input[name="applicant_name"]')?.value || '',
                institution: document.querySelector('input[name="institution"]')?.value || '',
                department: document.querySelector('input[name="department"]')?.value || '',
                email: document.querySelector('input[name="email"]')?.value || '',
                phone: document.querySelector('input[name="phone"]')?.value || '',
                sampleName: document.querySelector('textarea[name="sample_name"]')?.value || '',
                specialRequests: document.querySelector('textarea[name="special_requests"]')?.value || '',
                
                // ì²´í¬ë°•ìŠ¤ ë°ì´í„°
                sampleTypes: [],
                fixatives: [],
                services: []
            };
            
            // ê²€ì²´ ì¢…ë¥˜ ìˆ˜ì§‘
            if (document.getElementById('tissue')?.checked) data.sampleTypes.push('ì¡°ì§');
            if (document.getElementById('cell')?.checked) data.sampleTypes.push('ì„¸í¬');
            if (document.getElementById('other_sample')?.checked) data.sampleTypes.push('ê¸°íƒ€');
            
            // ê³ ì •ì•¡ ìˆ˜ì§‘
            if (document.getElementById('nbf')?.checked) data.fixatives.push('10% NBF');
            if (document.getElementById('alcohol')?.checked) data.fixatives.push('Alcohol');
            if (document.getElementById('other_fixative')?.checked) data.fixatives.push('ê¸°íƒ€');
            
            // ì„œë¹„ìŠ¤ ì •ë³´ ìˆ˜ì§‘
            for (let i = 1; i <= 4; i++) {
                const sampleCount = document.querySelector(`input[name="sample_count_${i}"]`)?.value;
                const serviceSelect = document.querySelector(`select[name="service_name_${i}"]`);
                const serviceName = serviceSelect?.selectedOptions[0]?.text;
                const antibodyType = document.querySelector(`input[name="antibody_type_${i}"]`)?.value;
                const slideCount = document.querySelector(`input[name="slide_count_${i}"]`)?.value;
                const totalCount = document.querySelector(`input[name="total_count_${i}"]`)?.value;
                
                if (sampleCount && serviceName) {
                    data.services.push({
                        index: i,
                        sampleCount: sampleCount,
                        serviceName: serviceName,
                        antibodyType: antibodyType || '',
                        slideCount: slideCount || '',
                        totalCount: totalCount || ''
                    });
                }
            }
            
            console.log('ğŸ“Š ìˆ˜ì§‘ëœ ì™„ì „í•œ ì‹ ì²­ì„œ ë°ì´í„°:', data);
            return data;
        }

        // ğŸ“¡ ì´ë¯¸ì§€ í¬í•¨ Google Apps Script ì „ì†¡ (í…ŒìŠ¤íŠ¸ ë²„ì „)
        function sendToGoogleAppsScriptWithImage(data) {
            return new Promise((resolve, reject) => {
                console.log('ğŸ¯ [ìë™í™” ì‹œìŠ¤í…œ] Google Apps Scriptë¡œ ë°ì´í„° ì „ì†¡ ì‹œì‘');
                console.log('ğŸ“¡ ì´ë¯¸ì§€ í¬í•¨ í…ŒìŠ¤íŠ¸ ì „ì†¡ ì¤‘...');
                
                // ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ: config.jsì˜ FORCE_EMAIL_SENDING ì„¤ì • í™•ì¸
                const isLocalhost = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.protocol === 'file:');
                const forceEmailSending = window.FORCE_EMAIL_SENDING !== undefined ? window.FORCE_EMAIL_SENDING : false;
                
                if (isLocalhost && !forceEmailSending) {
                    console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ë¡œì»¬ í™˜ê²½ì—ì„œ ì‹¤í–‰ ì¤‘ (ì´ë©”ì¼ ì‹œë®¬ë ˆì´ì…˜)');
                    handleLocalTestSubmission(data, resolve, reject);
                    return;
                }
                
                // í™˜ê²½ë³„ Google Apps Script URL ì‚¬ìš© (ì•ˆì „ ì¥ì¹˜ í¬í•¨)
                const scriptUrl = (window.CONFIG && window.CONFIG.googleAppsScript && window.CONFIG.googleAppsScript.url) 
                    ? window.CONFIG.googleAppsScript.url 
                    : 'https://script.google.com/macros/s/AKfycbwh3CuIlOAE6V3jwtalGq_m6x0QnmS6HkLweiSVmbgVMhSP1u1nuSscZ5-qywammr9fAg/exec';
                
                // JSONP ë°©ì‹ìœ¼ë¡œ ì „ì†¡ (CORS ìš°íšŒ)
                const callbackName = 'callback_' + Date.now();
                window[callbackName] = function(response) {
                    cleanup();
                    if (response && response.success) {
                        resolve(response);
                    } else {
                        reject(new Error(response?.error || 'ì „ì†¡ ì‹¤íŒ¨'));
                    }
                };
                
                const script = document.createElement('script');
                const params = new URLSearchParams({
                    callback: callbackName,
                    data: JSON.stringify(data)
                });
                
                script.src = `${scriptUrl}?${params.toString()}`;
                script.onerror = function() {
                    cleanup();
                    console.log('ğŸ“¡ JSONP ì‹¤íŒ¨, í´ë°± ì²˜ë¦¬');
                    // CORS ì˜¤ë¥˜ ì‹œì—ë„ ì‹¤ì œë¡œëŠ” ì „ì†¡ë  ìˆ˜ ìˆìŒ
                    resolve({
                        success: true,
                        receiptNumber: data.receiptNumber,
                        message: 'ì‹ ì²­ì„œê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì´ë©”ì¼ì´ ë°œì†¡ë©ë‹ˆë‹¤.'
                    });
                };
                
                function cleanup() {
                    if (window[callbackName]) {
                        delete window[callbackName];
                    }
                    if (script.parentNode) {
                        document.body.removeChild(script);
                    }
                }
                
                document.body.appendChild(script);
                
                // íƒ€ì„ì•„ì›ƒ ì„¤ì • (15ì´ˆ)
                setTimeout(() => {
                    if (window[callbackName]) {
                        cleanup();
                        resolve({
                            success: true,
                            receiptNumber: data.receiptNumber,
                            message: 'ì‹ ì²­ì„œê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ ë°œì†¡ê¹Œì§€ ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                        });
                    }
                }, 15000);
            });
        }
        
        // âœ… ì œì¶œ ì„±ê³µ ë©”ì‹œì§€
        function showSubmissionSuccess(response) {
            if (response.testMode) {
                // í…ŒìŠ¤íŠ¸ ëª¨ë“œ ë©”ì‹œì§€
                alert(`ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ì‹ ì²­ì„œ ì²˜ë¦¬ ì™„ë£Œ!

ğŸ“‹ ì ‘ìˆ˜ë²ˆí˜¸: ${response.receiptNumber}
ğŸ“¸ ì‹ ì²­ì„œ ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!
ğŸ“„ ì‹ ì²­ì„œ PDFê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!
ğŸ“§ ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì´ë©”ì¼ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš” (F12 > Console)

ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì•ˆë‚´:
â€¢ ì‹¤ì œ ì´ë©”ì¼ì€ ë°œì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
â€¢ ì‹ ì²­ì„œ ì´ë¯¸ì§€(.png)ì™€ PDF(.pdf)ê°€ ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤
â€¢ Google Apps Script ë°°í¬ í›„ ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤

ğŸ“ ë‹¤ìš´ë¡œë“œëœ íŒŒì¼:
  - ì‹ ì²­ì„œ_${response.receiptNumber}.png (ì´ë¯¸ì§€)
  - ì‹ ì²­ì„œ_${response.receiptNumber}.pdf (PDF)

ğŸ“ ë¬¸ì˜ì‚¬í•­: 051-510-8057, 8525
ğŸ“§ ì´ë©”ì¼: histopath.pnu@gmail.com

í…ŒìŠ¤íŠ¸ ì™„ë£Œ! ğŸš€`);
            } else {
                // ì‹¤ì œ ìš´ì˜ ëª¨ë“œ ë©”ì‹œì§€
                alert(`âœ… ì‹ ì²­ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!

ğŸ“‹ ì ‘ìˆ˜ë²ˆí˜¸: ${response.receiptNumber}
ğŸ“§ ì‹ ì²­ì„œ PDFì™€ í•¨ê»˜ ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!
ğŸ“Š Google Sheetsì— ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“ ì²¨ë¶€íŒŒì¼: ì‘ì„±í•˜ì‹  ì‹ ì²­ì„œê°€ PDF í˜•íƒœë¡œ ì²¨ë¶€ë©ë‹ˆë‹¤
â° ì´ë©”ì¼ ìˆ˜ì‹ ê¹Œì§€ 1-2ë¶„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤

ğŸ“ ë¬¸ì˜ì‚¬í•­: 051-510-8057, 8525
ğŸ“§ ì´ë©”ì¼: histopath.pnu@gmail.com

ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™`);
            }
        }
        
        // âŒ ì œì¶œ ì˜¤ë¥˜ ë©”ì‹œì§€  
        function showSubmissionError(error) {
            alert(`âŒ ì‹ ì²­ì„œ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

ğŸ“„ ì˜¤ë¥˜ ë‚´ìš©: ${error.message}

ğŸ”„ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì‹œê±°ë‚˜, ì•„ë˜ ì—°ë½ì²˜ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”:
ğŸ“ ì „í™”: 051-510-8057, 8525
ğŸ“§ ì´ë©”ì¼: histopath.pnu@gmail.com

ğŸ’¡ ì°¸ê³ : ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ë” ìì„¸í•œ ì˜¤ë¥˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
        }
        
        // ğŸ§ª ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì œì¶œ ì²˜ë¦¬
        function handleLocalTestSubmission(data, resolve, reject) {
            console.log('ğŸ§ª ë¡œì»¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì‹¤í–‰');
            
            // 3ì´ˆ í›„ ì„±ê³µ ì‘ë‹µ ì‹œë®¬ë ˆì´ì…˜
            setTimeout(async () => {
                try {
                    // 1. í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
                    downloadApplicationImage(data.applicationImage, `ì‹ ì²­ì„œ_${data.receiptNumber}.png`);
                    
                    // 2. PDF ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
                    try {
                        console.log('ğŸ“„ í…ŒìŠ¤íŠ¸ ëª¨ë“œì—ì„œ PDF ìƒì„± ì‹œì‘...');
                        const pdfData = await generateApplicationPDF(data.applicationImage, data.receiptNumber);
                        downloadApplicationPDF(pdfData.pdfDataUrl, pdfData.filename);
                        console.log('âœ… PDF ìƒì„± ë° ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
                    } catch (pdfError) {
                        console.log('âš ï¸ PDF ìƒì„± ì‹¤íŒ¨, ì´ë¯¸ì§€ë§Œ ì œê³µ:', pdfError.message);
                    }
                    
                    // 3. í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë³¸ë¬¸ ìƒì„±
                    const emailBody = generateTestEmailBody(data);
                    
                    // 4. ì½˜ì†”ì— ì´ë©”ì¼ ë‚´ìš© ì¶œë ¥
                    console.log('ğŸ“§ í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë‚´ìš©:', emailBody);
                    
                    // 5. í…ŒìŠ¤íŠ¸ ì„±ê³µ ì‘ë‹µ
                    resolve({
                        success: true,
                        receiptNumber: data.receiptNumber,
                        message: 'í…ŒìŠ¤íŠ¸ ëª¨ë“œì—ì„œ ì‹ ì²­ì„œê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        testMode: true,
                        hasImage: true,
                        hasPDF: true
                    });
                    
                } catch (error) {
                    reject(error);
                }
            }, 3000);
        }
        
        // ğŸ“¸ ì‹ ì²­ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        function downloadApplicationImage(imageDataUrl, filename) {
            if (!imageDataUrl) return;
            
            try {
                const link = document.createElement('a');
                link.href = imageDataUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                console.log('ğŸ“¸ ì‹ ì²­ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ:', filename);
            } catch (error) {
                console.error('âŒ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        // ğŸ“„ ì‹ ì²­ì„œ PDF ë‹¤ìš´ë¡œë“œ
        function downloadApplicationPDF(pdfDataUrl, filename) {
            if (!pdfDataUrl) return;
            
            try {
                const link = document.createElement('a');
                link.href = pdfDataUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                console.log('ğŸ“„ ì‹ ì²­ì„œ PDF ë‹¤ìš´ë¡œë“œ:', filename);
            } catch (error) {
                console.error('âŒ PDF ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }
        
        // ğŸ“§ í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë³¸ë¬¸ ìƒì„±
        function generateTestEmailBody(data) {
            return `ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„° ì„œë¹„ìŠ¤ ì‹ ì²­ì„œ (í…ŒìŠ¤íŠ¸)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ ì ‘ìˆ˜ë²ˆí˜¸: ${data.receiptNumber}
ğŸ“… ì‹ ì²­ì¼ì‹œ: ${data.signatureDate}
ğŸ§ª ìƒíƒœ: í…ŒìŠ¤íŠ¸ ëª¨ë“œ

â–  ì‹ ì²­ì ì •ë³´
ğŸ‘¤ ì‹ ì²­ì: ${data.name}
ğŸ¢ ì†Œì†ê¸°ê´€: ${data.institution}
ğŸ›ï¸ ë¶€ì„œ/í•™ê³¼: ${data.department}
ğŸ“§ ì´ë©”ì¼: ${data.email}
ğŸ“ ì—°ë½ì²˜: ${data.phone}

â–  ê²€ì²´ ì •ë³´
ğŸ§ª ê²€ì²´ëª…: ${data.sampleName || '-'}
ğŸ”¬ ê²€ì²´ ì¢…ë¥˜: ${data.sampleTypes.join(', ') || '-'}
âš—ï¸ ê³ ì •ì•¡: ${data.fixatives.join(', ') || '-'}

â–  ì‹ ì²­ ì„œë¹„ìŠ¤
${data.services.map((service, index) => 
`${index + 1}. ğŸ”¬ ë¶„ì„: ${service.serviceName}
   ğŸ“Š ê²€ì²´ ìˆ˜: ${service.sampleCount}ê°œ
   ğŸ§ª ìŠ¬ë¼ì´ë“œ ìˆ˜: ${service.slideCount || '-'}ê°œ
   ğŸ§¬ ì„¸ë¶€ë¶„ì„: ${service.antibodyType || '-'}
   ğŸ“ˆ ì´ ìˆ˜ëŸ‰: ${service.totalCount || '-'}ê°œ`
).join('\n\n')}

â–  íŠ¹ë³„ ìš”ì²­ì‚¬í•­
${data.specialRequests || 'ì—†ìŒ'}

â–  ì„œëª… ì •ë³´
ğŸ“ ì„œëª… ë°©ì‹: ${data.signatureType === 'digital' ? 'ë””ì§€í„¸ ì„œëª…' : 'í…ìŠ¤íŠ¸ ì„œëª…'}
âœï¸ ì„œëª…ì: ${data.signatureText || data.name}
ğŸ“… ì„œëª…ì¼: ${data.signatureDate}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ ì²¨ë¶€íŒŒì¼: ì‹ ì²­ì„œ ì´ë¯¸ì§€ê°€ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì•ˆë‚´:
â€¢ ì‹¤ì œ ì´ë©”ì¼ì€ ë°œì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
â€¢ ì‹ ì²­ì„œ ì´ë¯¸ì§€ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤
â€¢ Google Apps Script ë°°í¬ í›„ ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤

ê°ì‚¬í•©ë‹ˆë‹¤.

ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„°
ğŸ“ ì „í™”: 051-510-8057, 8525
ğŸ“§ ì´ë©”ì¼: histopath.pnu@gmail.com`;
        }

        // ì´ë©”ì¼ ë³¸ë¬¸ ìƒì„±
        function generateEmailBody(data) {
            return `ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„° ì„œë¹„ìŠ¤ ì‹ ì²­ì„œ

ì ‘ìˆ˜ë²ˆí˜¸: ${data.receipt_number || 'ìë™ìƒì„±'}
ì‹ ì²­ì¼: ${data.signature_date}

â–  ì‹ ì²­ì ì •ë³´
- ì‹ ì²­ì/ë‹´ë‹¹êµìˆ˜: ${data.applicant_name}
- ì†Œì†ê¸°ê´€: ${data.institution}
- ë¶€ì„œ/í•™ê³¼: ${data.department}
- ì´ë©”ì¼: ${data.email}
- ì—°ë½ì²˜: ${data.phone}

â–  ì„œë¹„ìŠ¤ ì •ë³´
${getServiceInfo(data)}

â–  ê²€ì²´ ì •ë³´
- ê²€ì²´ëª…: ${data.sample_name}
- ê²€ì²´ ì¢…ë¥˜: ${getSelectedOptions('sample_type', data)}
- ê³ ì •ì•¡: ${getSelectedOptions('fixative', data)}

â–  íŠ¹ë³„ ìš”ì²­ì‚¬í•­
${data.special_requests || 'ì—†ìŒ'}

â–  ì„œëª… ì •ë³´
- ì„œëª…ì: ${data.signature_name || 'ë””ì§€í„¸ ì„œëª…'}
- ì„œëª…ì¼: ${data.signature_date}

---
ë³¸ ì‹ ì²­ì„œëŠ” ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„° ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.
`;
        }

        // ì„ì‹œ: ìˆ˜ë™ ì´ë©”ì¼ ë°œì†¡ (í…ŒìŠ¤íŠ¸ìš©)
        function sendEmailsManually(data) {
            // ì´ë©”ì¼ ë³¸ë¬¸ ìƒì„±
            const emailBody = `ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„° ì„œë¹„ìŠ¤ ì‹ ì²­ì„œ

ì ‘ìˆ˜ë²ˆí˜¸: ìë™ìƒì„±
ì‹ ì²­ì¼: ${data.signature_date || new Date().toLocaleDateString()}

â–  ì‹ ì²­ì ì •ë³´
- ì‹ ì²­ì/ë‹´ë‹¹êµìˆ˜: ${data.name}
- ì†Œì†ê¸°ê´€: ${data.institution}
- ë¶€ì„œ/í•™ê³¼: ${data.department}
- ì´ë©”ì¼: ${data.email}
- ì—°ë½ì²˜: ${data.phone}

â–  ì„œë¹„ìŠ¤ ì •ë³´
${getServicesText(data.services)}

â–  ê²€ì²´ ì •ë³´
- ê²€ì²´ëª…: ${data.sampleName}
- ê²€ì²´ ì¢…ë¥˜: ${data.sampleTypes.join(', ') || 'ë¯¸ì„ íƒ'}
- ê³ ì •ì•¡: ${data.fixatives.join(', ') || 'ë¯¸ì„ íƒ'}

â–  íŠ¹ë³„ ìš”ì²­ì‚¬í•­
${data.specialRequests || 'ì—†ìŒ'}

---
ë³¸ ì‹ ì²­ì„œëŠ” ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„° ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.`;
            
            // ê´€ë¦¬ììš© ì´ë©”ì¼
            const adminSubject = `[ì‹ ê·œì‹ ì²­] ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„° ì„œë¹„ìŠ¤ ì‹ ì²­ - ${data.name}`;
            const adminMailto = `mailto:histopath.pnu@gmail.com?subject=${encodeURIComponent(adminSubject)}&body=${encodeURIComponent(emailBody)}`;
            
            // ì‹ ì²­ììš© ì´ë©”ì¼
            const applicantSubject = `[ì ‘ìˆ˜í™•ì¸] ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„° ì„œë¹„ìŠ¤ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤`;
            const applicantBody = `ì•ˆë…•í•˜ì„¸ìš”, ${data.name}ë‹˜.

ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„° ì„œë¹„ìŠ¤ ì‹ ì²­ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.

${emailBody}

ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½ ì£¼ì„¸ìš”.
ì „í™”: 051-510-8057, 8525
ì´ë©”ì¼: histopath.pnu@gmail.com

ê°ì‚¬í•©ë‹ˆë‹¤.
ë¶€ì‚°ëŒ€í•™êµ ì˜ê³¼ëŒ€í•™ ì¡°ì§ë³‘ë¦¬ì½”ì–´ì„¼í„°`;
            
            const applicantMailto = `mailto:${data.email}?subject=${encodeURIComponent(applicantSubject)}&body=${encodeURIComponent(applicantBody)}`;
            
            // ì´ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ ì—´ê¸°
            try {
                window.open(adminMailto);
                setTimeout(() => {
                    window.open(applicantMailto);
                    alert('âœ… ì‹ ì²­ì„œê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“§ ì´ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê´€ë¦¬ìì™€ ì‹ ì²­ìì—ê²Œ ë°œì†¡í•´ì£¼ì„¸ìš”.\n\ní–¥í›„ ì™„ì „ ìë™í™” ì‹œìŠ¤í…œìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œë  ì˜ˆì •ì…ë‹ˆë‹¤.');
                }, 1000);
            } catch (error) {
                alert('ì´ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nìˆ˜ë™ìœ¼ë¡œ ì´ë©”ì¼ì„ ë°œì†¡í•´ì£¼ì„¸ìš”.');
            }
        }

        function getServicesText(services) {
            if (!services || services.length === 0) return 'ì„œë¹„ìŠ¤ ì •ë³´ ì—†ìŒ';
            
            return services.map((service, index) => 
                `${index + 1}. ê²€ì²´ìˆ˜: ${service.sampleCount}, ë¶„ì„: ${service.mainService}, ì„¸ë¶€ë¶„ì„: ${service.antibodyType || '-'}, ìŠ¬ë¼ì´ë“œìˆ˜: ${service.slideCount || '-'}`
            ).join('\n');
        }

        // ì •ë¦¬ ì™„ë£Œ: ë¶ˆí•„ìš”í•œ í•¨ìˆ˜ë“¤ ì œê±°ë¨

        // í—¬í¼ í•¨ìˆ˜ë“¤
        function getServiceInfo(data) {
            let serviceInfo = '';
            for (let i = 1; i <= 4; i++) {
                const sampleCount = data[`sample_count_${i}`];
                const serviceName = data[`service_name_${i}`];
                if (sampleCount && serviceName) {
                    serviceInfo += `${i}. ê²€ì²´ìˆ˜: ${sampleCount}, ë¶„ì„: ${serviceName}, ì„¸ë¶€ë¶„ì„: ${data[`antibody_type_${i}`] || '-'}, ìŠ¬ë¼ì´ë“œìˆ˜: ${data[`slide_count_${i}`] || '-'}, ì´ìˆ˜ëŸ‰: ${data[`total_count_${i}`] || '-'}\n`;
                }
            }
            return serviceInfo || 'ì„œë¹„ìŠ¤ ì •ë³´ ì—†ìŒ';
        }

        function getSelectedOptions(name, data) {
            const options = [];
            Object.keys(data).forEach(key => {
                if (key.startsWith(name) && data[key]) {
                    options.push(data[key]);
                }
            });
            return options.join(', ') || 'ì„ íƒ ì—†ìŒ';
        }

        // ğŸš€ ì‹ ì²­ì„œ í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ğŸ¯ ë©”ì¸ í˜ì´ì§€ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°ë¡œ ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ (ìë™ì™„ì„± ê¸°ëŠ¥ ì—†ìŒ)
            autoCheckServicesFromMainPage();
            
            console.log('ğŸ¯ ì‹ ì²­ì„œ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            console.log('ğŸ“ ë©”ì¸ í˜ì´ì§€ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°ë§Œ ì²´í¬ë°•ìŠ¤ì— ë°˜ì˜ë©ë‹ˆë‹¤.');
        });

        // ğŸ¯ ë©”ì¸ í˜ì´ì§€ ì„œë¹„ìŠ¤ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ
        function autoCheckServicesFromMainPage() {
            try {
                // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì„œë¹„ìŠ¤ ë°ì´í„° ì½ê¸°
                const urlParams = new URLSearchParams(window.location.search);
                const serviceData = [];
                
                // ì„œë¹„ìŠ¤ ë°ì´í„° ìˆ˜ì§‘ (ìµœëŒ€ 4ê°œ ì„œë¹„ìŠ¤)
                for (let i = 1; i <= 4; i++) {
                    const serviceName = urlParams.get(`service_name_${i}`);
                    if (serviceName) {
                        serviceData.push(serviceName);
                    }
                }
                
                console.log('ğŸ“ ë©”ì¸ í˜ì´ì§€ì—ì„œ ì „ë‹¬ë°›ì€ ì„œë¹„ìŠ¤ ë°ì´í„°:', serviceData);
                
                if (serviceData.length > 0) {
                    // ë¨¼ì € ëª¨ë“  ì„œë¹„ìŠ¤ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
                    document.querySelectorAll('input[name="services"]').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    // ì„œë¹„ìŠ¤ëª…ì„ ì²´í¬ë°•ìŠ¤ ê°’ìœ¼ë¡œ ë§¤í•‘
                    const serviceMapping = {
                        'íŒŒë¼í•€ í¬ë§¤': 'paraffin',
                        'ë™ê²°ì ˆí¸': 'frozen',
                        'íŠ¹ìˆ˜ì—¼ìƒ‰': ['pas', 'masson', 'alcian_blue', 'pico_sirius_red', 'other_special'],
                        'ë©´ì—­ì¡°ì§í™”í•™ì—¼ìƒ‰ (IHC)': 'ihc',
                        'ë©´ì—­ì„¸í¬í™”í•™ì—¼ìƒ‰ (ICC)': 'icc',
                        'ë©´ì—­í˜•ê´‘ì—¼ìƒ‰ (IF)': 'if_staining',
                        'í˜•ê´‘ì œìë¦¬ë¶€í•©ë²• (FISH)': 'fish',
                        'Tissue Microarray (TMA)': 'tma',
                        'DNA/RNA ì¶”ì¶œ': ['dna_extraction', 'rna_extraction']
                    };
                    
                    // ì²´í¬ë°•ìŠ¤ ìë™ ì„ íƒ
                    serviceData.forEach(serviceName => {
                        const checkboxValues = serviceMapping[serviceName];
                        
                        if (checkboxValues) {
                            if (Array.isArray(checkboxValues)) {
                                // íŠ¹ìˆ˜ì—¼ìƒ‰ì´ë‚˜ DNA/RNA ì¶”ì¶œì²˜ëŸ¼ ì—¬ëŸ¬ ì²´í¬ë°•ìŠ¤ê°€ ë§¤í•‘ë˜ëŠ” ê²½ìš°
                                // ì²« ë²ˆì§¸ ì˜µì…˜ë§Œ ì²´í¬ (ì‚¬ìš©ìê°€ êµ¬ì²´ì ìœ¼ë¡œ ì„ íƒí•  ìˆ˜ ìˆë„ë¡)
                                const firstOption = checkboxValues[0];
                                const checkbox = document.querySelector(`input[name="services"][value="${firstOption}"]`);
                                if (checkbox) {
                                    checkbox.checked = true;
                                    console.log(`âœ… ìë™ ì²´í¬ë¨: ${serviceName} -> ${firstOption}`);
                                }
                            } else {
                                // ë‹¨ì¼ ì²´í¬ë°•ìŠ¤ ë§¤í•‘
                                const checkbox = document.querySelector(`input[name="services"][value="${checkboxValues}"]`);
                                if (checkbox) {
                                    checkbox.checked = true;
                                    console.log(`âœ… ìë™ ì²´í¬ë¨: ${serviceName} -> ${checkboxValues}`);
                                }
                            }
                        } else {
                            console.log(`âš ï¸ ë§¤í•‘ë˜ì§€ ì•Šì€ ì„œë¹„ìŠ¤: ${serviceName}`);
                        }
                    });
                    
                    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    setTimeout(() => {
                        if (serviceData.length > 0) {
                            console.log(`ğŸ‰ ë©”ì¸ í˜ì´ì§€ì—ì„œ ${serviceData.length}ê°œ ì„œë¹„ìŠ¤ê°€ ìë™ìœ¼ë¡œ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!`);
                        }
                    }, 200);
                } else {
                    console.log('ğŸ“ ë©”ì¸ í˜ì´ì§€ì—ì„œ ì „ë‹¬ë°›ì€ ì„œë¹„ìŠ¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('âŒ ì„œë¹„ìŠ¤ ìë™ ì„ íƒ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }
    </script>


    </script>

    <!-- ğŸ”§ í™˜ê²½ ì„¤ì • íŒŒì¼ ë¡œë“œ -->
    <script src="js/config.js"></script>
    
    <!-- ğŸ“¸ html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ (í¼ ìº¡ì²˜ìš©) -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html> 
</html> 